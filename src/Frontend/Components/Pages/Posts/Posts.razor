@page "/posts"
@rendermode InteractiveServer

<PageTitle>Posts</PageTitle>


<FluentLayout>
    <FluentHeader>        
        <FluentStack>
            <FluentNumberField @bind-Value="_maxArticles" Label="Max Posts" />
            <FluentButton OnClick="@FetchData">Refresh</FluentButton>
        </FluentStack>        
    </FluentHeader>

    <FluentGrid Justify="JustifyContent.FlexStart" 
                AdaptiveRendering="true"                
                Style="overflow: auto; width:100%"
                Spacing="0">

        @foreach (var post in Items!)
        {
           <FluentGridItem xs="12" md="12" lg="6" xl="4" xxl="3">
                <PostCard Post="post" />
           </FluentGridItem>
        }
    </FluentGrid>

    
</FluentLayout>
   

@code {
    [Inject]
    public FetchPostsQuery Query { get; set; } = default!;

    IEnumerable<Frontend.IFetchPosts_Posts_Nodes> Items 
        => Data?.Posts?.Nodes ?? Array.Empty<Frontend.IFetchPosts_Posts_Nodes>();

    IFetchPostsResult? Data;

    int _maxArticles = 30;

    protected override async Task OnInitializedAsync()
    {
        await FetchData();
    }

    public async Task FetchData()
    {
        var response = await Query.ExecuteAsync(_maxArticles);
        response.EnsureNoErrors();

        Data = response.Data;
        
        StateHasChanged();
    }
}